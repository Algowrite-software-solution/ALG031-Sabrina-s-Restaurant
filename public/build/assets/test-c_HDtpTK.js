import{j as e,r as D}from"./app-Ctv3DCth.js";import{D as I,a as B,b as L,c as V,d as R}from"./dialog-CywIAe6y.js";import{D as A,a as W,b as G,c as F}from"./dropdown-menu-D9aTuV-Q.js";import{a as _,b as P,c as O,d as z}from"./api-DA_L9G7C.js";import{t as $}from"./index-DQ6384iN.js";import{B as U}from"./button-CHd3yzlX.js";import{c as H}from"./react-BiT-3TUP.js";import{u as E,C as K,a as X,b as q,F as J}from"./index.esm-CnXlbr2N.js";import{D as Q}from"./default-table-muHYbLBh.js";import{c as Y}from"./createLucideIcon-psM7l3V3.js";import{P as Z}from"./page-layout-BuaGsMXw.js";import{productsConfig as C}from"./example-data-manager-BOLVeGtn.js";import"./utils-D-KgF5mV.js";import"./index-DDV7I9EH.js";import"./index-CXixcMmt.js";import"./index-cse7kVM7.js";import"./index-UM79rlCK.js";import"./index-DDT24Tts.js";import"./config-DdtzMSVa.js";import"./input-48ZtI7sD.js";import"./something-went-wrong-rf6XM-al.js";import"./something-went-wrong-AJ--9wM9.js";import"./chevron-down-aFUXUWst.js";import"./sonner-DTMNrJMT.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],se=Y("Ellipsis",ee),te=H((t,l)=>({data:[],loading:!0,error:null,isModalOpen:!1,modalMode:null,selectedItem:null,fetchData:async(a,x)=>{t({loading:!0,error:null});try{const s=await _(a,{displayError:!0,...x});t({data:s.data||[],loading:!1})}catch(s){t({error:s.message||"Failed to fetch data",loading:!1})}},openModal:(a,x=null)=>{t({isModalOpen:!0,modalMode:a,selectedItem:x})},closeModal:()=>{t({isModalOpen:!1,modalMode:null,selectedItem:null})}})),re=({totalSteps:t,currentStep:l})=>{const a=(l+1)/t*100;return e.jsx("div",{className:"bg-muted mb-6 h-2.5 w-full rounded-full",children:e.jsx("div",{className:"h-2.5 rounded-full bg-blue-600",style:{width:`${a}%`,transition:"width 0.3s ease-in-out"}})})},ae=({fieldConfig:t,onFileChange:l,onInteraction:a})=>{const{name:x,fileConfig:s}=t,[r,d]=D.useState([]),u=async i=>{const h=Array.from(i.target.files||[]);if(h.length!==0)if(s!=null&&s.async&&s.uploadUrl){const b=[];for(const o of h){const c=new FormData;c.append(s.formKey??"file",o);try{const n=await P(s.uploadUrl,{data:c,isMultipart:!0});b.push(n.url),console.log(n),d(j=>[...j,{id:n.url,url:n.url,name:o.name,type:o.type.startsWith("image")?"image":o.type.startsWith("video")?"video":"other",isUploaded:!0}])}catch(n){console.error("Async upload failed",n)}}l(s.multiple?b:b[0])}else{const b=h.map(c=>({id:URL.createObjectURL(c),url:URL.createObjectURL(c),name:c.name,type:c.type.startsWith("image")?"image":c.type.startsWith("video")?"video":"other",isUploaded:!1,fileObject:c}));d(s!=null&&s.multiple?[...r,...b]:b);const o=b.map(c=>c.fileObject).filter(Boolean);l(s!=null&&s.multiple?o:o[0])}},y=async i=>{const h=r.find(o=>o.id===i);if(!h)return;if(h.isUploaded&&(s!=null&&s.async)&&s.deleteUrl)try{await O(s.deleteUrl)}catch(o){console.error("Failed to delete remote file",o)}const b=r.filter(o=>o.id!==i);if(d(b),s!=null&&s.async){const o=b.map(c=>c.url);l(s.multiple?o:o[0]||null)}else{const o=b.map(c=>c.fileObject).filter(Boolean);l(s!=null&&s.multiple?o:o[0]||null)}};return e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:s==null?void 0:s.accept,multiple:s==null?void 0:s.multiple,onChange:u,className:"block w-full text-sm text-gray-500 file:mr-4 file:rounded-full file:border-0 file:bg-blue-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-blue-700 hover:file:bg-blue-100"}),(s==null?void 0:s.preview)&&r.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 gap-4 md:grid-cols-4",children:r.map(i=>e.jsxs("div",{className:"group relative",children:[i.type==="image"&&e.jsx("img",{src:i.url,alt:i.name,className:"bg-background/50 h-64 w-full rounded-md object-contain shadow-lg"}),i.type==="video"&&e.jsx("video",{src:i.url,className:"h-24 w-full rounded-md object-cover",controls:!0}),i.type==="other"&&e.jsx("div",{className:"flex h-24 w-full items-center justify-center rounded-md bg-gray-100 p-2",children:e.jsx("p",{className:"truncate text-center text-xs",children:i.name})}),e.jsx("button",{type:"button",onClick:()=>y(i.id),className:"absolute top-1 right-1 flex h-5 w-5 cursor-pointer items-center justify-center rounded-full bg-red-500 text-xs text-white opacity-0 transition-opacity group-hover:opacity-100",children:"X"})]},i.id))})]})},T=({fieldConfig:t,onInteraction:l})=>{const{register:a,formState:{errors:x},control:s}=E(),{name:r,label:d,type:u,placeholder:y,options:i,validation:h,className:b,wrapperClassName:o,defaultValue:c}=t,n=x[r],j=(p,S)=>{l&&l(r,p,S),t.onInteraction&&t.onInteraction(r,p,S)},f={id:r,className:`w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 ${n?"border-red-500":"border-gray-300"} ${b||""}`,onClick:p=>j("click",p.target.value),onChange:p=>j("change",p.target.value)},v=()=>{switch(u){case"textarea":return e.jsx("textarea",{...a(r,h),...f,placeholder:y,defaultValue:c});case"select":return e.jsxs("select",{...a(r,h),...f,defaultValue:c,children:[y&&e.jsx("option",{value:"",children:y}),i==null?void 0:i.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))]});case"radio":return e.jsx("div",{className:"flex flex-col space-y-2",children:i==null?void 0:i.map(p=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"radio",...a(r,h),value:p.value,defaultChecked:c===p.value}),e.jsx("span",{children:p.label})]},p.value))});case"checkbox":return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",...a(r,h),...f,style:{width:"auto"},defaultChecked:c}),e.jsx("label",{htmlFor:r,children:d})]});case"file":return e.jsx(K,{name:r,control:s,rules:h,defaultValue:c,render:({field:p})=>e.jsx(ae,{fieldConfig:t,onFileChange:p.onChange,onInteraction:l})});default:return e.jsx("input",{type:u,...a(r,h),...f,placeholder:y,defaultValue:c})}};return e.jsxs("div",{className:o||"",children:[u!=="checkbox"&&e.jsx("label",{htmlFor:r,className:"mb-1 block font-medium",children:d}),v(),n&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:n.message})]})},le=({groupConfig:t,onInteraction:l})=>{const{register:a,control:x}=E(),s=X({control:x,name:t.name});return e.jsxs("div",{className:`rounded-md border border-foreground p-4 ${t.className||""}`,children:[t.toggleable?e.jsxs("label",{className:"mb-4 flex items-center space-x-2 font-semibold",children:[e.jsx("input",{type:"checkbox",...a(t.name)}),e.jsx("span",{children:t.label})]}):e.jsx("h3",{className:"mb-4 font-semibold",children:t.label}),e.jsx("hr",{className:"mb-4"}),e.jsx("div",{className:`space-y-4 ${t.toggleable&&!s?"pointer-events-none opacity-50":""}`,children:t.fields.map((r,d)=>{if(r.component){const u=r.component;return e.jsx(u,{fieldConfig:r},d)}else return e.jsx(T,{fieldConfig:r,onInteraction:l},d)})})]})},ne=({stepConfig:t,onInteraction:l})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:t.title}),t.description&&e.jsx("p",{className:"mb-4 text-sm text-gray-500",children:t.description}),e.jsx("div",{className:"space-y-6",children:t.fields.map((a,x)=>{if("isGroup"in a)return e.jsx(le,{groupConfig:a,onInteraction:l},x);if(a.component){const s=a.component;return e.jsx(s,{fieldConfig:a,onInteraction:l},x)}else return a.component?"test":e.jsx(T,{fieldConfig:a,onInteraction:l},x)})})]});function ce({options:t}){const[l,a]=D.useState(0),[x,s]=D.useState(!1),r=q({shouldUnregister:!1}),{handleSubmit:d,trigger:u,formState:{errors:y}}=r,i=l===t.steps.length-1,h=D.useMemo(()=>t.steps.some(n=>n.fields.some(j=>"type"in j&&j.type==="file")),[t.steps]),b=async()=>{const n=t.steps[l].fields.flatMap(f=>"isGroup"in f?f.fields.map(v=>v.name):[f.name]);await u(n)&&!i&&a(f=>f+1)},o=()=>{l>0&&a(n=>n-1)},c=async n=>{s(!0);const j=new FormData;let f=!1;for(const m in n)n[m]instanceof FileList||n[m]instanceof File?(f=!0,(n[m]instanceof FileList?Array.from(n[m]):[n[m]]).forEach(w=>j.append(m,w))):n[m]!==void 0&&n[m]!==null&&j.append(m,n[m]);const v=h||f,S=(t.method||"POST")==="PUT"?z:P;try{const m=await S(t.endpoint,{data:v?j:n,isMultipart:v,onSuccess:t.onSuccess,onError:t.onError});console.log("Form submitted successfully:",m)}catch(m){console.error("Submission failed:",m)}finally{s(!1)}};return e.jsxs("div",{className:`bg-secondary text-secondary-foreground rounded-lg p-4 shadow-md md:p-8 ${t.formClassName||""}`,children:[t.title&&e.jsx("h1",{className:"mb-2 text-2xl font-bold",children:t.title}),t.description&&e.jsx("p",{className:"text-muted-foreground mb-6",children:t.description}),t.steps.length>1&&e.jsx(re,{totalSteps:t.steps.length,currentStep:l}),e.jsx(J,{...r,children:e.jsxs("form",{onSubmit:d(c),noValidate:!0,children:[e.jsx(ne,{stepConfig:t.steps[l],onInteraction:t.onInteraction}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[l>0&&e.jsx("button",{type:"button",onClick:o,className:"rounded-md bg-gray-300 px-6 py-2 text-gray-800",children:"Previous"}),!i&&e.jsx("button",{type:"button",onClick:b,className:"ml-auto rounded-md bg-blue-600 px-6 py-2 text-white",children:"Next"}),i&&e.jsx("button",{type:"submit",disabled:x,className:"ml-auto rounded-md bg-green-600 px-6 py-2 text-white disabled:bg-gray-400",children:x?"Submitting...":t.submitButtonText||"Submit"})]})]})})]})}function oe({config:t}){const{apiBaseUrl:l,dataName:a,tableConfig:x,formConfig:s,addConfig:r,editConfig:d,viewConfig:u,layoutConfig:y}=t,{data:i,loading:h,isModalOpen:b,modalMode:o,selectedItem:c,fetchData:n,openModal:j,closeModal:f}=te();D.useEffect(()=>{n(l)},[l,n]);const v=()=>{f(),$.success(`${a} ${o==="add"?"created":"updated"} successfully.`),n(l)},p=async N=>{$.promise(O(`${l}`,{data:{id:N},displayError:!1,displaySuccess:!1}),{loading:`Deleting ${a}...`,success:()=>(n(l),`${a} deleted successfully.`),error:`Failed to delete ${a}.`})},S=D.useMemo(()=>{const N={id:"actions",cell:({row:w})=>{const M=w.original;return e.jsx("div",{className:"text-right",children:e.jsxs(A,{children:[e.jsx(W,{asChild:!0,children:e.jsxs(U,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(se,{className:"h-4 w-4"})]})}),e.jsxs(G,{align:"end",children:[u&&e.jsx(F,{onClick:()=>j("view",M),children:"View"}),d&&e.jsx(F,{onClick:()=>j("edit",M),children:"Edit"}),e.jsx(F,{className:"text-destructive focus:bg-destructive/10 focus:text-destructive",onClick:()=>p(M.id),children:"Delete"})]})]})})}};return[...x.columns,N]},[x.columns,u,d,j,p]),m=D.useMemo(()=>{if(!o)return null;const N={...s,onSuccess:v,onError:w=>console.error("Form submission error:",w)};switch(o){case"add":return{...N,...r==null?void 0:r.formOverrides,endpoint:l,method:"POST",title:(r==null?void 0:r.modalTitle)||`Add New ${a}`,description:r==null?void 0:r.modalDescription};case"edit":if(!c)return null;const w=N.steps.map(k=>({...k,fields:k.fields.map(g=>"isGroup"in g?g:{...g,defaultValue:c[g.name]??g.defaultValue})}));return{...N,...d==null?void 0:d.formOverrides,endpoint:`${l}/${c.id}`,method:"PUT",title:(d==null?void 0:d.modalTitle)||`Edit ${a}`,description:d==null?void 0:d.modalDescription,steps:w};case"view":if(!c)return null;const M=N.steps.map(k=>({...k,fields:k.fields.map(g=>"isGroup"in g?g:{...g,validation:{...g.validation,disabled:!0},defaultValue:c[g.name]})}));return{...N,...u==null?void 0:u.formOverrides,endpoint:"",title:(u==null?void 0:u.modalTitle)||`${a} Details`,description:u==null?void 0:u.modalDescription,steps:M,submitButtonText:""};default:return null}},[o,c,s,r,d,u,l,a,v]);return e.jsxs("div",{className:`bg-background text-foreground p-4 ${(y==null?void 0:y.containerClassName)||""}`,children:[e.jsx(Q,{columns:S,data:i,searchComponent:x.searchComponent,actionButtons:e.jsx(U,{onClick:()=>j("add"),className:r==null?void 0:r.triggerButtonClassName,children:(r==null?void 0:r.triggerButtonText)||`Add New ${a}`}),children:h&&e.jsx("p",{children:"Loading data..."})}),e.jsx(I,{open:b,onOpenChange:f,children:e.jsxs(B,{className:`bg-card text-card-foreground max-h-screen overflow-y-auto sm:max-w-[425px] md:max-w-screen-md ${y==null?void 0:y.modalClassName}`,children:[e.jsxs(L,{children:[e.jsx(V,{children:m==null?void 0:m.title}),(m==null?void 0:m.description)&&e.jsx(R,{children:m.description})]}),m?e.jsx(ce,{options:m}):e.jsx("p",{children:"Loading form..."})]})})]})}function Ee(){return e.jsx(Z,{children:e.jsx("section",{className:"container mx-auto py-5",children:e.jsx(oe,{config:C})})})}export{Ee as default};
